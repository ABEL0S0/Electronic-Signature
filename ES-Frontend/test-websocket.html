<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test WebSocket</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #results { margin-top: 20px; padding: 10px; border: 1px solid #ccc; min-height: 200px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Test WebSocket Connection</h1>
    <button onclick="testBackend()">Test Backend HTTP</button>
    <button onclick="testWebSocket()">Test WebSocket</button>
    <button onclick="testAuth()">Test Authentication</button>
    <button onclick="clearResults()">Clear Results</button>
    <div id="results"></div>

    <script>
        let ws = null;

        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `<p class="${type}">[${timestamp}] ${message}</p>`;
            results.scrollTop = results.scrollHeight;
        }

        async function testBackend() {
            try {
                const response = await fetch('http://localhost:8080/api/auth/health');
                const text = await response.text();
                addResult(`‚úÖ Backend HTTP: ${text}`, 'success');
            } catch (error) {
                addResult(`‚ùå Backend HTTP Error: ${error.message}`, 'error');
            }
        }

        function testWebSocket() {
            try {
                ws = new WebSocket('ws://localhost:8080/ws');
                
                ws.onopen = () => {
                    addResult('‚úÖ WebSocket conectado exitosamente', 'success');
                };
                
                ws.onmessage = (event) => {
                    addResult(`üì® WebSocket mensaje: ${event.data}`, 'info');
                };
                
                ws.onerror = (error) => {
                    addResult(`‚ùå WebSocket error: ${error}`, 'error');
                };
                
                ws.onclose = (event) => {
                    addResult(`üîå WebSocket cerrado: ${event.code} - ${event.reason}`, 'info');
                };
            } catch (error) {
                addResult(`‚ùå WebSocket Error: ${error.message}`, 'error');
            }
        }

        function testAuth() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addResult('‚ùå WebSocket no est√° conectado', 'error');
                return;
            }

            // Token de ejemplo (deber√≠as usar un token real)
            const testToken = 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiaWF0IjoxNzM1MjQ5NjAwLCJleHAiOjE3MzUzMzYwMDB9.test';
            
            const authMessage = {
                type: 'AUTH',
                token: testToken
            };
            
            ws.send(JSON.stringify(authMessage));
            addResult(`üîê Enviando autenticaci√≥n: ${JSON.stringify(authMessage)}`, 'info');
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
    </script>
</body>
</html> 